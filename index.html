<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ramadhan Display | Purwokerto</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f172a;
  --panel:#111827;
  --primary:#22d3ee;
  --accent:#fbbf24;
  --text:#f8fafc;
  --muted:#94a3b8;
  --active:#10b981;
}
*{box-sizing:border-box;font-family:'Inter',sans-serif}
body{margin:0;background:radial-gradient(circle at 30% 30%,#1e293b,var(--bg));color:var(--text);min-height:100vh;padding:20px;transition:.4s ease}

.wrapper{
  display:grid;
  grid-template-columns:1fr;
  gap:24px;
  max-width:1400px;
  margin:auto;
  transition:.4s ease;
}

/* TV MODE ACTIVE */
body.tv-mode .wrapper{
  grid-template-columns:1.2fr 1fr;
}

.panel{
  background:var(--panel);
  border-radius:28px;
  padding:32px;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
}

.header-top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}

.tv-toggle{
  background:rgba(34,211,238,.15);
  color:var(--primary);
  border:none;
  padding:8px 14px;
  border-radius:999px;
  cursor:pointer;
  font-size:12px;
  font-weight:600;
}

.small-clock{
  font-size:16px;
  font-weight:600;
  color:var(--primary);
}

.title{font-size:clamp(22px,3vw,34px);font-weight:800}
.hijri{font-size:14px;color:var(--muted)}
.countdown-label{text-transform:uppercase;font-size:14px;letter-spacing:2px;color:var(--muted);margin-top:20px}
.main-time{font-size:clamp(48px,7vw,96px);font-weight:800;letter-spacing:4px;color:var(--primary);margin-top:10px}
.active-indicator{margin-top:16px;font-size:16px;font-weight:600;color:var(--active)}
.table-wrapper{overflow:hidden;border-radius:20px}
table{width:100%;border-collapse:collapse}
th{background:#1f2937;padding:14px;font-size:12px;text-transform:uppercase;color:var(--muted)}
td{padding:14px;border-bottom:1px solid #1e293b;font-size:14px}
tr.today{background:rgba(34,211,238,.1);border-left:4px solid var(--primary)}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:flex;align-items:center;justify-content:center;flex-direction:column;opacity:0;pointer-events:none;transition:.4s ease;z-index:999}
.overlay.show{opacity:1}
.overlay h1{font-size:clamp(40px,6vw,80px);color:var(--accent);margin:0}
.overlay p{margin-top:12px;font-size:clamp(22px,4vw,36px)}

@media(max-width:1100px){
  body.tv-mode .wrapper{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="overlay" id="overlay">
  <h1>WAKTU ADZAN</h1>
  <p id="overlayName"></p>
</div>

<div class="wrapper">

<div class="panel">
  <div class="header-top">
    <div>
      <div class="title">Jadwal Ramadhan - Purwokerto</div>
      <div class="hijri" id="hijriDate">Hijriyah</div>
    </div>
    <div style="text-align:right">
      <div class="small-clock" id="smallClock">00:00:00</div>
      <button class="tv-toggle" id="tvToggle">Aktifkan TV Mode</button>
    </div>
  </div>

  <div class="countdown-label" id="nextLabel">Menuju ...</div>
  <div class="main-time" id="mainTime">--:--:--</div>
  <div class="active-indicator" id="activeIndicator"></div>
</div>

<div class="panel">
  <div class="table-wrapper">
  <table>
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Imsak</th>
        <th>Subuh</th>
        <th>Dzuhur</th>
        <th>Ashar</th>
        <th>Maghrib</th>
        <th>Isya</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="7">Memuat data...</td></tr>
    </tbody>
  </table>
  </div>
</div>

</div>

<script>
const lat=-7.4242;
const lon=109.2396;
const method=20;
const school=0;

const tbody=document.getElementById('tbody');
const mainTime=document.getElementById('mainTime');
const nextLabel=document.getElementById('nextLabel');
const overlay=document.getElementById('overlay');
const overlayName=document.getElementById('overlayName');
const smallClock=document.getElementById('smallClock');
const hijriDate=document.getElementById('hijriDate');
const activeIndicator=document.getElementById('activeIndicator');
const tvToggle=document.getElementById('tvToggle');

let ramadhanData=[];
let todayPrayers=[];

// Toggle TV Mode
tvToggle.addEventListener('click',()=>{
  document.body.classList.toggle('tv-mode');
  if(document.body.classList.contains('tv-mode')){
    tvToggle.textContent='Nonaktifkan TV Mode';
    enableFullscreen();
  }else{
    tvToggle.textContent='Aktifkan TV Mode';
  }
});

function enableFullscreen(){
  const el=document.documentElement;
  if(el.requestFullscreen) el.requestFullscreen();
}

async function init(){
const year=new Date().getFullYear();
for(let m=1;m<=12;m++){
const res=await fetch(`https://api.aladhan.com/v1/calendar?latitude=${lat}&longitude=${lon}&method=${method}&school=${school}&month=${m}&year=${year}`);
const data=await res.json();
if(data.code!==200) continue;
data.data.forEach(d=>{
if(d.date.hijri.month.number===9) ramadhanData.push(d);
});
}
renderTable();
prepareToday();
}

function renderTable(){
tbody.innerHTML='';
const now=new Date();
ramadhanData.forEach(d=>{
const tr=document.createElement('tr');
const [dd,mm,yyyy]=d.date.gregorian.date.split('-').map(Number);
if(dd===now.getDate()&&mm===now.getMonth()+1&&yyyy===now.getFullYear()) tr.classList.add('today');
tr.innerHTML=`<td>${d.date.readable}</td>
<td>${clean(d.timings.Imsak)}</td>
<td>${clean(d.timings.Fajr)}</td>
<td>${clean(d.timings.Dhuhr)}</td>
<td>${clean(d.timings.Asr)}</td>
<td>${clean(d.timings.Maghrib)}</td>
<td>${clean(d.timings.Isha)}</td>`;
tbody.appendChild(tr);
});
}

function clean(t){return t.replace(/\s*\(.+\)/,'').trim();}

function prepareToday(){
const now=new Date();
const today=ramadhanData.find(d=>{
const [dd,mm,yyyy]=d.date.gregorian.date.split('-').map(Number);
return dd===now.getDate()&&mm===now.getMonth()+1&&yyyy===now.getFullYear();
});
if(!today) return;

hijriDate.textContent=`${today.date.hijri.day} ${today.date.hijri.month.en} ${today.date.hijri.year} H`;

const [dd,mm,yyyy]=today.date.gregorian.date.split('-').map(Number);
const prayers=[
{name:'Subuh',time:clean(today.timings.Fajr)},
{name:'Dzuhur',time:clean(today.timings.Dhuhr)},
{name:'Ashar',time:clean(today.timings.Asr)},
{name:'Maghrib',time:clean(today.timings.Maghrib)},
{name:'Isya',time:clean(today.timings.Isha)}
];

todayPrayers=prayers.map(p=>{
const [h,m]=p.time.split(':').map(Number);
return {...p,date:new Date(yyyy,mm-1,dd,h,m,0)};
});

setInterval(updateDisplay,1000);
}

function updateDisplay(){
const now=new Date();
smallClock.textContent=formatClock(now);

let next=todayPrayers.find(p=>p.date>now);

if(next){
nextLabel.textContent='Menuju '+next.name;
mainTime.textContent=format(next.date-now);
activeIndicator.textContent='Waktu aktif: '+getActivePrayer(now);
if(next.date-now<=1000 && next.date-now>0) triggerAdzan(next.name);
}else{
nextLabel.textContent='Jam Sekarang';
mainTime.textContent=formatClock(now);
activeIndicator.textContent='Menunggu hari berikutnya';
}
}

function getActivePrayer(now){
for(let i=todayPrayers.length-1;i>=0;i--){
if(now>=todayPrayers[i].date) return todayPrayers[i].name;
}
return 'Belum masuk waktu';
}

function triggerAdzan(name){
overlayName.textContent=name;
overlay.classList.add('show');
setTimeout(()=>overlay.classList.remove('show'),10000);
}

function format(ms){
if(ms<=0) return '00:00:00';
const t=Math.floor(ms/1000);
const h=Math.floor(t/3600);
const m=Math.floor((t%3600)/60);
const s=t%60;
return`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function formatClock(d){
return`${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
}

init();
</script>

</body>
</html>